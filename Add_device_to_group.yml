- hosts: fortimanager
  collections:
    - fortinet.fortimanager
  connection: httpapi
  vars:
    ansible_httpapi_use_ssl: true
    ansible_httpapi_validate_certs: false
    ansible_network_os: fortinet.fortimanager.fortimanager
    ansible_user: "admin"
    ansible_password: "admin"
    ansible_host: "192.168.10.6"
  tasks:
    - name: Add device to the group
      fortinet.fortimanager.fmgr_dvmdb_group_objectmember:
        adom: "root"  # Administrative Domain, most likely "root"
        group: "HUBs"  # Name of the device group
        state: "present"  # To add the device to the group
        dvmdb_group_objectmember:
          name: "Hub"  # The device name
          vdom: "root"  # Virtual Domain (usually "root" unless custom VDOM is used)
    - name: Add Spoke devices to 'spokes' group using loop
      fortinet.fortimanager.fmgr_dvmdb_group_addmember:
        adom: "root"
        group: "spokes"
        member:
          - name: "{{ item }}"
            vdom: "root"   # ⚠️ Remplacez si les VDOMs sont différents
        state: "present"
        mode: "set"        # Force l'ajout même si le groupe existe déjà
      loop:
        - "spoke1"
        - "spoke2"
